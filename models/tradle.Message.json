{
  "id": "tradle.Message",
  "type": "tradle.Model",
  "title": "Message",
  "properties": {
    "recipientPubKey": {
      "type": "object",
      "inlined": true,
      "properties": {
        "curve": {
          "type": "string"
        },
        "pub": {
          "type": "bytes"
        }
      }
    },
    "object": {
      "type": "object",
      "inlined": true,
      "ref": "tradle.Object"
    },
    "time": {
      "type": "date"
    },
    "context": {
      "type": "string"
    },
    "forward": {
      "type": "string"
    },
    "originalSender": {
      "type": "string",
      "description": "for proxied messages"
    },
    "originalRecipient": {
      "type": "string",
      "description": "for proxied messages"
    },
    "inReplyTo": {
      "type": "string"
    },
    "iOfN": {
      "type": "object",
      "properties": {
        "i": {
          "type": "number"
        },
        "n": {
          "type": "number"
        }
      }
    },
    "_n": {
      "type": "number",
      "readOnly": true,
      "immutable": true,
      "description": "message sequence number, for this recipient",
      "sample": "random.number"
    },
    "_q": {
      "type": "string",
      "readOnly": true,
      "immutable": true,
      "description": "link to the previous message sent to this recipient",
      "sample": "hash"
    },
    "_recipient": {
      "type": "string",
      "virtual": true
    },
    "_payloadType": {
      "type": "string",
      "virtual": true
    },
    "_payloadLink": {
      "type": "string",
      "virtual": true
    },
    "_payloadRecipient": {
      "type": "string",
      "virtual": true
    },
    "_inbound": {
      "type": "boolean",
      "virtual": true
    },
    "_counterparty": {
      "type": "string",
      "virtual": true,
      "description": "_author if inbound, _recipient otherwise"
    },
    "_dcounterparty": {
      "type": "string",
      "virtual": true,
      "description": "property used for indexing in/outbound messages by counterparty"
    }
  },
  "required": [
    "recipientPubKey",
    "object",
    "time"
  ],
  "primaryKeys": {
    "hashKey": "_counterparty",
    "rangeKey": "time"
  },
  "indexes": [
    {
      "hashKey": "_dcounterparty",
      "rangeKey": "time"
    },
    {
      "hashKey": "context",
      "rangeKey": "time"
    },
    {
      "hashKey": "_payloadType",
      "rangeKey": "time"
    },
    {
      "hashKey": "_link"
    }
  ]
}
